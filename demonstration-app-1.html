<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.2 Demonstration app | Data-Science Reactivity: Three Ways</title>
  <meta name="description" content="2.2 Demonstration app | Data-Science Reactivity: Three Ways" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2.2 Demonstration app | Data-Science Reactivity: Three Ways" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.2 Demonstration app | Data-Science Reactivity: Three Ways" />
  
  
  

<meta name="author" content="Ian Lyttle" />


<meta name="date" content="2022-03-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="principles-1.html"/>
<link rel="next" href="observable.html"/>
<script src="libs/header-attrs-2.11.3/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script>
  // wait for the DOM to finish loading, then run function
  window.addEventListener('DOMContentLoaded', (event) => {

    // we want to set some element styles according to the class of the book
    //   - the theme of the book depends on class including:
    //       color-theme-1: means sepia
    //       color-theme-2: means night
    //       neither of these means white

    // see: https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/observe#examples
    // identify an element to observe
    const elementToObserve = document.querySelector(".book");

    // create a new instance of `MutationObserver` named `observer`,
    // passing it a callback function
    const observer = new MutationObserver(function() {

      // img elements with src attribute that end in '.svg'
      const selImageSvg = 'img[src$=".svg"]';

      // span elements used for source-code highlighting
      const selCodeHighlight = 'code.sourceCode > span > span:not(.bu):not(.im)';

      // create a callback function for an element to change its style.filter
      const setFilter = (value) => {
        return (element) => element.style.filter = value;
      }

      if (elementToObserve.classList.contains('color-theme-1')) {
        // console.log('i am sepia');

        // sepia images
        document.querySelectorAll(selImageSvg).forEach(setFilter('sepia(100%'));

        // do nothing to highlighting
        document.querySelectorAll(selCodeHighlight).forEach(setFilter(null));

     } else if (elementToObserve.classList.contains('color-theme-2')) {
        // console.log('i am night');

        // invert images
        document.querySelectorAll(selImageSvg).forEach(setFilter('invert(100%)'));

        // invert highlighting
        document.querySelectorAll(selCodeHighlight).forEach(setFilter('invert(100%)'));

      } else {
        // console.log('i am white');

        // do nothing to images
        document.querySelectorAll(selImageSvg).forEach(setFilter(null));

        // do nothing to highlighting
        document.querySelectorAll(selCodeHighlight).forEach(setFilter(null));
      }

    });

    // call `observe()` on that MutationObserver instance,
    // passing it the element to observe, and the options object
    observer.observe(elementToObserve, {attributeFilter: ['class']});

    // touch class to initiate observe event
    elementToObserve.classList = elementToObserve.classList;

  });
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data-Science Reactivity: Three Ways</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>1</b> Shiny</a>
<ul>
<li class="chapter" data-level="1.1" data-path="principles.html"><a href="principles.html"><i class="fa fa-check"></i><b>1.1</b> Principles</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="principles.html"><a href="principles.html#pure-functions-vs.-side-effects"><i class="fa fa-check"></i><b>1.1.1</b> Pure functions vs. side effects</a></li>
<li class="chapter" data-level="1.1.2" data-path="principles.html"><a href="principles.html#reactives-vs.-observers"><i class="fa fa-check"></i><b>1.1.2</b> Reactives vs. observers</a></li>
<li class="chapter" data-level="1.1.3" data-path="principles.html"><a href="principles.html#using-tidyverse-functions"><i class="fa fa-check"></i><b>1.1.3</b> Using tidyverse functions</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="demonstration-app.html"><a href="demonstration-app.html"><i class="fa fa-check"></i><b>1.2</b> Demonstration App</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="demonstration-app.html"><a href="demonstration-app.html#description"><i class="fa fa-check"></i><b>1.2.1</b> Description</a></li>
<li class="chapter" data-level="1.2.2" data-path="demonstration-app.html"><a href="demonstration-app.html#prelims"><i class="fa fa-check"></i><b>1.2.2</b> Prelims</a></li>
<li class="chapter" data-level="1.2.3" data-path="demonstration-app.html"><a href="demonstration-app.html#helper-functions"><i class="fa fa-check"></i><b>1.2.3</b> Helper functions</a></li>
<li class="chapter" data-level="1.2.4" data-path="demonstration-app.html"><a href="demonstration-app.html#ui"><i class="fa fa-check"></i><b>1.2.4</b> UI</a></li>
<li class="chapter" data-level="1.2.5" data-path="demonstration-app.html"><a href="demonstration-app.html#server-function"><i class="fa fa-check"></i><b>1.2.5</b> Server function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dash.html"><a href="dash.html"><i class="fa fa-check"></i><b>2</b> Dash</a>
<ul>
<li class="chapter" data-level="2.1" data-path="principles-1.html"><a href="principles-1.html"><i class="fa fa-check"></i><b>2.1</b> Principles</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="principles-1.html"><a href="principles-1.html#everything-that-exists-is-a-component"><i class="fa fa-check"></i><b>2.1.1</b> Everything that exists is a component</a></li>
<li class="chapter" data-level="2.1.2" data-path="principles-1.html"><a href="principles-1.html#everything-that-happens-is-a-callback"><i class="fa fa-check"></i><b>2.1.2</b> Everything that happens is a callback</a></li>
<li class="chapter" data-level="2.1.3" data-path="principles-1.html"><a href="principles-1.html#server-cannot-store-state"><i class="fa fa-check"></i><b>2.1.3</b> Server cannot store state</a></li>
<li class="chapter" data-level="2.1.4" data-path="principles-1.html"><a href="principles-1.html#use-json-or-base64"><i class="fa fa-check"></i><b>2.1.4</b> Use JSON or base64</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html"><i class="fa fa-check"></i><b>2.2</b> Demonstration app</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#description-1"><i class="fa fa-check"></i><b>2.2.1</b> Description</a></li>
<li class="chapter" data-level="2.2.2" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#prelims-1"><i class="fa fa-check"></i><b>2.2.2</b> Prelims</a></li>
<li class="chapter" data-level="2.2.3" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#helper-functions-1"><i class="fa fa-check"></i><b>2.2.3</b> Helper functions</a></li>
<li class="chapter" data-level="2.2.4" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#compmonent-layout"><i class="fa fa-check"></i><b>2.2.4</b> Compmonent layout</a></li>
<li class="chapter" data-level="2.2.5" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#callback-functions"><i class="fa fa-check"></i><b>2.2.5</b> Callback functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="observable.html"><a href="observable.html"><i class="fa fa-check"></i><b>3</b> Observable</a>
<ul>
<li class="chapter" data-level="3.1" data-path="principles-2.html"><a href="principles-2.html"><i class="fa fa-check"></i><b>3.1</b> Principles</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="principles-2.html"><a href="principles-2.html#hosted-service-runs-in-browser"><i class="fa fa-check"></i><b>3.1.1</b> Hosted service runs in browser</a></li>
<li class="chapter" data-level="3.1.2" data-path="principles-2.html"><a href="principles-2.html#reactivity-baked-in"><i class="fa fa-check"></i><b>3.1.2</b> Reactivity baked in</a></li>
<li class="chapter" data-level="3.1.3" data-path="principles-2.html"><a href="principles-2.html#javascript"><i class="fa fa-check"></i><b>3.1.3</b> JavaScript</a></li>
<li class="chapter" data-level="3.1.4" data-path="principles-2.html"><a href="principles-2.html#tidyverse-thinking-helps"><i class="fa fa-check"></i><b>3.1.4</b> Tidyverse thinking helps</a></li>
<li class="chapter" data-level="3.1.5" data-path="principles-2.html"><a href="principles-2.html#viewof-is-a-useful-construct"><i class="fa fa-check"></i><b>3.1.5</b> <code>viewof</code> is a useful construct</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html"><i class="fa fa-check"></i><b>3.2</b> Demonstration app</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html#showcase"><i class="fa fa-check"></i><b>3.2.1</b> Showcase</a></li>
<li class="chapter" data-level="3.2.2" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html#workshop"><i class="fa fa-check"></i><b>3.2.2</b> Workshop</a></li>
<li class="chapter" data-level="3.2.3" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html#appendix"><i class="fa fa-check"></i><b>3.2.3</b> Appendix</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="stray-thoughts.html"><a href="stray-thoughts.html"><i class="fa fa-check"></i><b>A</b> Stray Thoughts</a></li>
<li class="chapter" data-level="B" data-path="field-guide-to-python.html"><a href="field-guide-to-python.html"><i class="fa fa-check"></i><b>B</b> Field Guide to Python</a>
<ul>
<li class="chapter" data-level="B.1" data-path="python-installation.html"><a href="python-installation.html"><i class="fa fa-check"></i><b>B.1</b> Python installation</a></li>
<li class="chapter" data-level="B.2" data-path="project-management.html"><a href="project-management.html"><i class="fa fa-check"></i><b>B.2</b> Project management</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="project-management.html"><a href="project-management.html#git"><i class="fa fa-check"></i><b>B.2.1</b> Git</a></li>
<li class="chapter" data-level="B.2.2" data-path="project-management.html"><a href="project-management.html#virtual-environment"><i class="fa fa-check"></i><b>B.2.2</b> Virtual Environment</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data-Science Reactivity: Three Ways</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="demonstration-app-1" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Demonstration app</h2>
<p>I’ve tried to brief in outlining the priniciples for a Dash app; I think they will make more sense in the context of the Dash demo-app.</p>
<div id="description-1" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Description</h3>
<p>Here is the reactive graph for the demonstration app.</p>
<p>It’s a little busier than the Shiny app; Dash forces the developer to be explicit, Shiny makes some things implicit.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="images/dash-aggregate-local.svg" alt="Reactivity diagram for Dash"  />
<p class="caption">
Figure 2.1: Reactivity diagram for Dash
</p>
</div>
<p>A few things to note about this diagram:</p>
<ul>
<li><p>Each rectangle is a layout component; each circle is a callback function.</p></li>
<li><p>Components have properties, which are associated with arguments to callback functions.</p></li>
<li><p>When an argument to a callback function changes, the function is (re-)run.</p></li>
<li><p>The output(s) of callback functions are used to update the properties of components.</p></li>
<li><p>Functions are run, properties are updated, and so on, until the app “comes to rest”.</p></li>
</ul>
<p>There are a few more things formalized in the diagram, but we’ll get to them as we discuss the demo app:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="images/dash-legend.svg" alt="Legend: reactivity diagram for Dash"  />
<p class="caption">
Figure 2.2: Legend: reactivity diagram for Dash
</p>
</div>
</div>
<div id="prelims-1" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Prelims</h3>
<p>As with Shiny, in the rest of this chapter, we’ll highlight the code used to make app, and the design choices behind the code.
In the <a href="https://github.com/ijlyttle/reactivity-demo-dash">repository</a>, there are a some files to pay attention to:</p>
<pre><code>app-aggregate-local.py
helpers/
  __init__.py
  aggregate.py
  cols.py</code></pre>
<p>Here’s the app file, <code>app-aggregate-local.py</code>, with the components and callbacks removed:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="demonstration-app-1.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run this app with `python app-aggregate-local.py` and</span></span>
<span id="cb40-2"><a href="demonstration-app-1.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># visit http://127.0.0.1:8050/ in your web browser.</span></span>
<span id="cb40-3"><a href="demonstration-app-1.html#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="demonstration-app-1.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dash</span>
<span id="cb40-5"><a href="demonstration-app-1.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dash.dependencies <span class="im">import</span> Input, Output, State</span>
<span id="cb40-6"><a href="demonstration-app-1.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dash <span class="im">import</span> dash_table</span>
<span id="cb40-7"><a href="demonstration-app-1.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dash <span class="im">import</span> html</span>
<span id="cb40-8"><a href="demonstration-app-1.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dash <span class="im">import</span> dcc</span>
<span id="cb40-9"><a href="demonstration-app-1.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dash_bootstrap_components <span class="im">as</span> dbc</span>
<span id="cb40-10"><a href="demonstration-app-1.html#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="demonstration-app-1.html#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb40-12"><a href="demonstration-app-1.html#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> palmerpenguins <span class="im">import</span> load_penguins</span>
<span id="cb40-13"><a href="demonstration-app-1.html#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="demonstration-app-1.html#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> helpers.aggregate <span class="im">import</span> aggregate_df, agg_function_choices</span>
<span id="cb40-15"><a href="demonstration-app-1.html#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> helpers.cols <span class="im">import</span> cols_choice, cols_header</span>
<span id="cb40-16"><a href="demonstration-app-1.html#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="demonstration-app-1.html#cb40-17" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> load_penguins()</span>
<span id="cb40-18"><a href="demonstration-app-1.html#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="demonstration-app-1.html#cb40-19" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> dash.Dash(</span>
<span id="cb40-20"><a href="demonstration-app-1.html#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">__name__</span>, </span>
<span id="cb40-21"><a href="demonstration-app-1.html#cb40-21" aria-hidden="true" tabindex="-1"></a>    external_stylesheets<span class="op">=</span>[dbc.themes.BOOTSTRAP]</span>
<span id="cb40-22"><a href="demonstration-app-1.html#cb40-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-23"><a href="demonstration-app-1.html#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="demonstration-app-1.html#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="co"># make `server` available to Heroku</span></span>
<span id="cb40-25"><a href="demonstration-app-1.html#cb40-25" aria-hidden="true" tabindex="-1"></a>server <span class="op">=</span> app.server</span>
<span id="cb40-26"><a href="demonstration-app-1.html#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="demonstration-app-1.html#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;component layout&gt;</span></span>
<span id="cb40-28"><a href="demonstration-app-1.html#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="demonstration-app-1.html#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;callback functions&gt;</span></span>
<span id="cb40-30"><a href="demonstration-app-1.html#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="demonstration-app-1.html#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb40-32"><a href="demonstration-app-1.html#cb40-32" aria-hidden="true" tabindex="-1"></a>    app.run_server(debug<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p>The first part of the file handles the imports.
You will need to have installed (hopefully in your virtual environment): <code>dash</code>, <code>dash_bootstrap_components</code>, <code>pandas</code>, and <code>palmerpenguins</code>.
For example:</p>
<pre><code>&gt; pip install dash</code></pre>
<p>The remaining bits of the file set up our app:</p>
<ul>
<li><p>Load the <code>penguins</code> data.</p></li>
<li><p>Create the <code>app</code>.
This is the standard way to create a Dash app; note that we are using the Bootstrap styling.</p></li>
<li><p>We make the <code>app.server</code> available at the top level as <code>server</code>.
This goes a little beyond the scope of this chapter, but we are doing this as a part of deploying the app on Heroku.</p></li>
<li><p>Components and callbacks, we’ll look at these in detail in following sections.</p></li>
<li><p>A standard bit of code that tells Python to <code>app.runServer()</code> when we execute this file.</p></li>
</ul>
<p>We also have a <code>helpers</code> directory with some files.
The <code>__init__.py</code> file is empty; its purpose is to signal to Python that there are <code>.py</code> files in this directory with functions that can be imported.</p>
</div>
<div id="helper-functions-1" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Helper functions</h3>
<p>Just like in R, I like to write as much “vanilla” Python code as I can.
I want to demonstrate to myself, as much as I can, that the “guts” of the app behaves as I expect.
That way, when I’m building the components and the callbacks, I can narrow down the things that might be going wrong.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="demonstration-app-1.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using only to demonstrate code; not used in Python Dash.</span></span>
<span id="cb42-2"><a href="demonstration-app-1.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;reticulate&quot;</span>)</span></code></pre></div>
<p>I’m reproducing this code in an RMarkdown document, so I’m using the reticulate package to run Python.
You will not need to do this to create a Dash app; you can work in a purely Python environment.</p>
<p>In fact, if you are newish to Python, you might find the “Field Guide” appendix useful to get things set up.
For Python programming, there is a great introduction at reticulate.</p>
<p>Our first step is to get a look at the <code>penguins</code> dataset, to verify it’s the same as we use in R.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="demonstration-app-1.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importing into RMarkdown environment for exposition</span></span>
<span id="cb43-2"><a href="demonstration-app-1.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb43-3"><a href="demonstration-app-1.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> palmerpenguins <span class="im">import</span> load_penguins</span>
<span id="cb43-4"><a href="demonstration-app-1.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="demonstration-app-1.html#cb43-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> load_penguins()</span>
<span id="cb43-6"><a href="demonstration-app-1.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(penguins)</span></code></pre></div>
<pre><code>##        species     island  bill_length_mm  ...  body_mass_g     sex  year
## 0       Adelie  Torgersen            39.1  ...       3750.0    male  2007
## 1       Adelie  Torgersen            39.5  ...       3800.0  female  2007
## 2       Adelie  Torgersen            40.3  ...       3250.0  female  2007
## 3       Adelie  Torgersen             NaN  ...          NaN     NaN  2007
## 4       Adelie  Torgersen            36.7  ...       3450.0  female  2007
## ..         ...        ...             ...  ...          ...     ...   ...
## 339  Chinstrap      Dream            55.8  ...       4000.0    male  2009
## 340  Chinstrap      Dream            43.5  ...       3400.0  female  2009
## 341  Chinstrap      Dream            49.6  ...       3775.0    male  2009
## 342  Chinstrap      Dream            50.8  ...       4100.0    male  2009
## 343  Chinstrap      Dream            50.2  ...       3775.0  female  2009
## 
## [344 rows x 8 columns]</code></pre>
<p>Because we will tell Dash to move data back and forth using a dictionary, we’ll make a variable that stores <code>penguins</code> as records:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="demonstration-app-1.html#cb45-1" aria-hidden="true" tabindex="-1"></a>penguins_records <span class="op">=</span> penguins.to_dict(<span class="st">&#39;records&#39;</span>)</span>
<span id="cb45-2"><a href="demonstration-app-1.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(penguins_records[<span class="dv">0</span>:<span class="dv">2</span>]) <span class="co"># just to get a flavor</span></span></code></pre></div>
<pre><code>## [{&#39;species&#39;: &#39;Adelie&#39;, &#39;island&#39;: &#39;Torgersen&#39;, &#39;bill_length_mm&#39;: 39.1, &#39;bill_depth_mm&#39;: 18.7, &#39;flipper_length_mm&#39;: 181.0, &#39;body_mass_g&#39;: 3750.0, &#39;sex&#39;: &#39;male&#39;, &#39;year&#39;: 2007}, {&#39;species&#39;: &#39;Adelie&#39;, &#39;island&#39;: &#39;Torgersen&#39;, &#39;bill_length_mm&#39;: 39.5, &#39;bill_depth_mm&#39;: 17.4, &#39;flipper_length_mm&#39;: 186.0, &#39;body_mass_g&#39;: 3800.0, &#39;sex&#39;: &#39;female&#39;, &#39;year&#39;: 2007}]</code></pre>
<p>The first function we’ll verify is used to tell us, for a given a data frame and a given Pandas type, which columns are of that type.
(In the app, we’ll convert to records-format in the callback function.)</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="demonstration-app-1.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cols_choice (df, include):</span>
<span id="cb47-2"><a href="demonstration-app-1.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="demonstration-app-1.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.select_dtypes(include<span class="op">=</span>include).columns.to_list()</span></code></pre></div>
<p>Let’s test the function.
In Pandas, strings have type <code>'object'</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="demonstration-app-1.html#cb48-1" aria-hidden="true" tabindex="-1"></a>cols_choice(penguins, <span class="st">&#39;object&#39;</span>)</span></code></pre></div>
<pre><code>## [&#39;species&#39;, &#39;island&#39;, &#39;sex&#39;]</code></pre>
<p>Numbers have type <code>'number'</code>:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="demonstration-app-1.html#cb50-1" aria-hidden="true" tabindex="-1"></a>cols_choice(penguins, <span class="st">&#39;number&#39;</span>)</span></code></pre></div>
<pre><code>## [&#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;, &#39;flipper_length_mm&#39;, &#39;body_mass_g&#39;, &#39;year&#39;]</code></pre>
<p>So far, so good.</p>
<p>Next, we need a function to generate the (display) table properties.
We need to return a list where each element is dictionary that describes a column in the data frame.
As we’ll see later, this is the format we need to specify the table headers.</p>
<p>Note that we are <em>not</em> using the data-frame format in this function, so we can keep everything in records format.
We use a trick by looking at only the first (well, zeroth) record.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="demonstration-app-1.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cols_header (data_records):</span>
<span id="cb52-2"><a href="demonstration-app-1.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-3"><a href="demonstration-app-1.html#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">len</span>(data_records) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb52-4"><a href="demonstration-app-1.html#cb52-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb52-5"><a href="demonstration-app-1.html#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="demonstration-app-1.html#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [{<span class="st">&#39;name&#39;</span>: v, <span class="st">&#39;id&#39;</span>: v} <span class="cf">for</span> v <span class="kw">in</span> data_records[<span class="dv">0</span>].keys()]</span></code></pre></div>
<p>There’s all sorts of ways to do this in Python.
I’m a sucker for functional programming, so here’s how to use a <code>map()</code> function.
This returns a map object, so we need to change it to a list.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="demonstration-app-1.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(</span>
<span id="cb53-2"><a href="demonstration-app-1.html#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">map</span>(<span class="kw">lambda</span> v: {<span class="st">&#39;name&#39;</span>: v, <span class="st">&#39;id&#39;</span>: v}, data_records[<span class="dv">0</span>].keys())</span>
<span id="cb53-3"><a href="demonstration-app-1.html#cb53-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This works largely like R’s <code>purrr::map()</code>, but in Python, we provide the function first, then the thing we are iterating over.
Here’s a purrr equivalent:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="demonstration-app-1.html#cb54-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">names</span>(data_records[<span class="dv">1</span>]), <span class="sc">~</span><span class="fu">list</span>(<span class="at">name =</span> .x, <span class="at">id =</span> .x))</span></code></pre></div>
<p>Anyhow, let’s try out our Python function:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="demonstration-app-1.html#cb55-1" aria-hidden="true" tabindex="-1"></a>cols_header(penguins_records)  </span></code></pre></div>
<pre><code>## [{&#39;name&#39;: &#39;species&#39;, &#39;id&#39;: &#39;species&#39;}, {&#39;name&#39;: &#39;island&#39;, &#39;id&#39;: &#39;island&#39;}, {&#39;name&#39;: &#39;bill_length_mm&#39;, &#39;id&#39;: &#39;bill_length_mm&#39;}, {&#39;name&#39;: &#39;bill_depth_mm&#39;, &#39;id&#39;: &#39;bill_depth_mm&#39;}, {&#39;name&#39;: &#39;flipper_length_mm&#39;, &#39;id&#39;: &#39;flipper_length_mm&#39;}, {&#39;name&#39;: &#39;body_mass_g&#39;, &#39;id&#39;: &#39;body_mass_g&#39;}, {&#39;name&#39;: &#39;sex&#39;, &#39;id&#39;: &#39;sex&#39;}, {&#39;name&#39;: &#39;year&#39;, &#39;id&#39;: &#39;year&#39;}]</code></pre>
<p>This seems OK.</p>
<p>Finally, we need an aggregation function.
We send a data frame, then some lists of column-names, and a string naming an aggregation-function.
This is an exercise in Pandas - I think this works, but my lack of experience in Pandas suggests there may be a “better” way.
We’ll write this as in terms of data frames; we’ll convert to/from records-format in the callback function.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="demonstration-app-1.html#cb57-1" aria-hidden="true" tabindex="-1"></a>agg_function_choices <span class="op">=</span> [<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;min&#39;</span>, <span class="st">&#39;max&#39;</span>]</span>
<span id="cb57-2"><a href="demonstration-app-1.html#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="demonstration-app-1.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aggregate_df (df, cols_group, cols_agg, func_agg,</span>
<span id="cb57-4"><a href="demonstration-app-1.html#cb57-4" aria-hidden="true" tabindex="-1"></a>                  str_fn_choices <span class="op">=</span> agg_function_choices):</span>
<span id="cb57-5"><a href="demonstration-app-1.html#cb57-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-6"><a href="demonstration-app-1.html#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> func_agg <span class="kw">in</span> str_fn_choices:</span>
<span id="cb57-7"><a href="demonstration-app-1.html#cb57-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">AssertionError</span>(<span class="ss">f&quot;</span><span class="sc">{</span>func_agg<span class="sc">}</span><span class="ss"> not a legal function-choice&quot;</span>)</span>
<span id="cb57-8"><a href="demonstration-app-1.html#cb57-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-9"><a href="demonstration-app-1.html#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cols_group <span class="op">!=</span> <span class="va">None</span>):</span>
<span id="cb57-10"><a href="demonstration-app-1.html#cb57-10" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.groupby(cols_group)</span>
<span id="cb57-11"><a href="demonstration-app-1.html#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="demonstration-app-1.html#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cols_agg <span class="op">==</span> <span class="va">None</span> <span class="kw">or</span> <span class="bu">len</span>(cols_agg) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb57-13"><a href="demonstration-app-1.html#cb57-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb57-14"><a href="demonstration-app-1.html#cb57-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-15"><a href="demonstration-app-1.html#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dictionary, keys: column-names, values: function-name</span></span>
<span id="cb57-16"><a href="demonstration-app-1.html#cb57-16" aria-hidden="true" tabindex="-1"></a>    dict_agg <span class="op">=</span> {i: func_agg <span class="cf">for</span> i <span class="kw">in</span> cols_agg}</span>
<span id="cb57-17"><a href="demonstration-app-1.html#cb57-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-18"><a href="demonstration-app-1.html#cb57-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.agg(dict_agg).reset_index()</span>
<span id="cb57-19"><a href="demonstration-app-1.html#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="demonstration-app-1.html#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb57-21"><a href="demonstration-app-1.html#cb57-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-22"><a href="demonstration-app-1.html#cb57-22" aria-hidden="true" tabindex="-1"></a>aggregate_df(</span>
<span id="cb57-23"><a href="demonstration-app-1.html#cb57-23" aria-hidden="true" tabindex="-1"></a>  penguins, </span>
<span id="cb57-24"><a href="demonstration-app-1.html#cb57-24" aria-hidden="true" tabindex="-1"></a>  cols_group <span class="op">=</span> <span class="st">&quot;island&quot;</span>, </span>
<span id="cb57-25"><a href="demonstration-app-1.html#cb57-25" aria-hidden="true" tabindex="-1"></a>  cols_agg <span class="op">=</span> [<span class="st">&quot;bill_length_mm&quot;</span>, <span class="st">&quot;bill_depth_mm&quot;</span>],</span>
<span id="cb57-26"><a href="demonstration-app-1.html#cb57-26" aria-hidden="true" tabindex="-1"></a>  func_agg <span class="op">=</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb57-27"><a href="demonstration-app-1.html#cb57-27" aria-hidden="true" tabindex="-1"></a>)  </span></code></pre></div>
<pre><code>##       island  bill_length_mm  bill_depth_mm
## 0     Biscoe       45.257485      15.874850
## 1      Dream       44.167742      18.344355
## 2  Torgersen       38.950980      18.429412</code></pre>
<p>This may be interesting only to me, but there is a more “functional” way to write the statement:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="demonstration-app-1.html#cb59-1" aria-hidden="true" tabindex="-1"></a>dict_agg <span class="op">=</span> {i: func_agg <span class="cf">for</span> i <span class="kw">in</span> cols_agg}</span></code></pre></div>
<p>Using a reducer:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="demonstration-app-1.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb60-2"><a href="demonstration-app-1.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="demonstration-app-1.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build (acc, val):</span>
<span id="cb60-4"><a href="demonstration-app-1.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  new_dict <span class="op">=</span> <span class="bu">dict</span>(acc)</span>
<span id="cb60-5"><a href="demonstration-app-1.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  new_dict[val] <span class="op">=</span> func_agg</span>
<span id="cb60-6"><a href="demonstration-app-1.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-7"><a href="demonstration-app-1.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> new_dict</span>
<span id="cb60-8"><a href="demonstration-app-1.html#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="demonstration-app-1.html#cb60-9" aria-hidden="true" tabindex="-1"></a>dict_agg <span class="op">=</span> <span class="bu">reduce</span>(build, cols_agg, {})</span></code></pre></div>
<p>In this situation, it’s more verbose and, I think, less clear what is going on unless you are into functional programming.
Please pardon this diversion.</p>
<p>Confident that the “guts” of the app works, we move onto the components and the callbacks.</p>
</div>
<div id="compmonent-layout" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Compmonent layout</h3>
<p>Let’s start with the formatting.
In the app, we need to create an <code>app.layout</code>, which will be the HTML used to render our app in the browser.
Just like with Shiny, we’re using Bootstrap, but we have to be a little more explicit.
In Shiny, Bootstrap is “baked in”; in Dash, it’s an add-on.</p>
<p>Here’s the “formatting” bits of the layout; the <code>...</code> represent Dash components that we’ll discuss presently:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="demonstration-app-1.html#cb61-1" aria-hidden="true" tabindex="-1"></a>app.layout <span class="op">=</span> html.Div(</span>
<span id="cb61-2"><a href="demonstration-app-1.html#cb61-2" aria-hidden="true" tabindex="-1"></a>    className<span class="op">=</span><span class="st">&#39;container-fluid&#39;</span>,</span>
<span id="cb61-3"><a href="demonstration-app-1.html#cb61-3" aria-hidden="true" tabindex="-1"></a>    children<span class="op">=</span>[</span>
<span id="cb61-4"><a href="demonstration-app-1.html#cb61-4" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb61-5"><a href="demonstration-app-1.html#cb61-5" aria-hidden="true" tabindex="-1"></a>        html.H2(<span class="st">&#39;Aggregator&#39;</span>),</span>
<span id="cb61-6"><a href="demonstration-app-1.html#cb61-6" aria-hidden="true" tabindex="-1"></a>        html.Div(</span>
<span id="cb61-7"><a href="demonstration-app-1.html#cb61-7" aria-hidden="true" tabindex="-1"></a>            className<span class="op">=</span><span class="st">&#39;row&#39;</span>,</span>
<span id="cb61-8"><a href="demonstration-app-1.html#cb61-8" aria-hidden="true" tabindex="-1"></a>            children <span class="op">=</span>[</span>
<span id="cb61-9"><a href="demonstration-app-1.html#cb61-9" aria-hidden="true" tabindex="-1"></a>                html.Div(</span>
<span id="cb61-10"><a href="demonstration-app-1.html#cb61-10" aria-hidden="true" tabindex="-1"></a>                    className<span class="op">=</span><span class="st">&#39;col-sm-4&#39;</span>,</span>
<span id="cb61-11"><a href="demonstration-app-1.html#cb61-11" aria-hidden="true" tabindex="-1"></a>                    children<span class="op">=</span>[</span>
<span id="cb61-12"><a href="demonstration-app-1.html#cb61-12" aria-hidden="true" tabindex="-1"></a>                        dbc.Card([</span>
<span id="cb61-13"><a href="demonstration-app-1.html#cb61-13" aria-hidden="true" tabindex="-1"></a>                            dbc.CardHeader(<span class="st">&#39;Aggregation&#39;</span>),</span>
<span id="cb61-14"><a href="demonstration-app-1.html#cb61-14" aria-hidden="true" tabindex="-1"></a>                            dbc.CardBody([</span>
<span id="cb61-15"><a href="demonstration-app-1.html#cb61-15" aria-hidden="true" tabindex="-1"></a>                              ...</span>
<span id="cb61-16"><a href="demonstration-app-1.html#cb61-16" aria-hidden="true" tabindex="-1"></a>                            ])</span>
<span id="cb61-17"><a href="demonstration-app-1.html#cb61-17" aria-hidden="true" tabindex="-1"></a>                        ])</span>
<span id="cb61-18"><a href="demonstration-app-1.html#cb61-18" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb61-19"><a href="demonstration-app-1.html#cb61-19" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb61-20"><a href="demonstration-app-1.html#cb61-20" aria-hidden="true" tabindex="-1"></a>                html.Div(</span>
<span id="cb61-21"><a href="demonstration-app-1.html#cb61-21" aria-hidden="true" tabindex="-1"></a>                    className<span class="op">=</span><span class="st">&#39;col-sm-8&#39;</span>,</span>
<span id="cb61-22"><a href="demonstration-app-1.html#cb61-22" aria-hidden="true" tabindex="-1"></a>                    children<span class="op">=</span>[</span>
<span id="cb61-23"><a href="demonstration-app-1.html#cb61-23" aria-hidden="true" tabindex="-1"></a>                        html.H3(<span class="st">&#39;Input data&#39;</span>),</span>
<span id="cb61-24"><a href="demonstration-app-1.html#cb61-24" aria-hidden="true" tabindex="-1"></a>                        ...</span>
<span id="cb61-25"><a href="demonstration-app-1.html#cb61-25" aria-hidden="true" tabindex="-1"></a>                        html.Hr(),</span>
<span id="cb61-26"><a href="demonstration-app-1.html#cb61-26" aria-hidden="true" tabindex="-1"></a>                        html.H3(<span class="st">&#39;Aggregated data&#39;</span>),</span>
<span id="cb61-27"><a href="demonstration-app-1.html#cb61-27" aria-hidden="true" tabindex="-1"></a>                        ...</span>
<span id="cb61-28"><a href="demonstration-app-1.html#cb61-28" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb61-29"><a href="demonstration-app-1.html#cb61-29" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb61-30"><a href="demonstration-app-1.html#cb61-30" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb61-31"><a href="demonstration-app-1.html#cb61-31" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-32"><a href="demonstration-app-1.html#cb61-32" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb61-33"><a href="demonstration-app-1.html#cb61-33" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
<div id="data-stores" class="section level4" number="2.2.4.1">
<h4><span class="header-section-number">2.2.4.1</span> Data stores</h4>
<p>The first parts I want to highlight are the data stores:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="demonstration-app-1.html#cb62-1" aria-hidden="true" tabindex="-1"></a>dcc.Store(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;inp&#39;</span>, data<span class="op">=</span>penguins.to_dict(<span class="st">&#39;records&#39;</span>)),</span>
<span id="cb62-2"><a href="demonstration-app-1.html#cb62-2" aria-hidden="true" tabindex="-1"></a>dcc.Store(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;agg&#39;</span>, data<span class="op">=</span>[])</span></code></pre></div>
<p>Recall that the server part of a Dash app cannot store its state.
Instead, we will store the state, in our case: the input and aggregated data, in the DOM.
Dash provides a <code>dcc.Store()</code> component; in its <code>data</code> property, we store the records-based data (note the use of <code>.to_dict('records')</code>.
Also note that, just like Shiny, components each have an <code>id</code> property.</p>
</div>
<div id="inputs-1" class="section level4" number="2.2.4.2">
<h4><span class="header-section-number">2.2.4.2</span> Inputs</h4>
<p>Let’s look at the components that specify the aggregation:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="demonstration-app-1.html#cb63-1" aria-hidden="true" tabindex="-1"></a>dcc.Dropdown(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;cols-group&#39;</span>, multi<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb63-2"><a href="demonstration-app-1.html#cb63-2" aria-hidden="true" tabindex="-1"></a>dcc.Dropdown(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;cols-agg&#39;</span>, multi<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb63-3"><a href="demonstration-app-1.html#cb63-3" aria-hidden="true" tabindex="-1"></a>dbc.Select(</span>
<span id="cb63-4"><a href="demonstration-app-1.html#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="st">&#39;func-agg&#39;</span>,</span>
<span id="cb63-5"><a href="demonstration-app-1.html#cb63-5" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>[{<span class="st">&#39;label&#39;</span>: v, <span class="st">&#39;value&#39;</span>: v} <span class="cf">for</span> v <span class="kw">in</span> agg_function_choices],</span>
<span id="cb63-6"><a href="demonstration-app-1.html#cb63-6" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span>agg_function_choices[<span class="dv">0</span>]</span>
<span id="cb63-7"><a href="demonstration-app-1.html#cb63-7" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb63-8"><a href="demonstration-app-1.html#cb63-8" aria-hidden="true" tabindex="-1"></a>dbc.Button(<span class="bu">id</span><span class="op">=</span><span class="st">&#39;button-agg&#39;</span>, children<span class="op">=</span><span class="st">&#39;Submit&#39;</span>, class_name<span class="op">=</span><span class="st">&#39;btn btn-secondary&#39;</span>)</span></code></pre></div>
<p>Here, we’re using a couple of “standard” (<code>dcc</code>) dropdowns and a couple of Bootstrap (<code>dbc</code>) components.</p>
<p>With the dropdowns, other than providing the <code>id</code>, we specify that multiple selections can be made.
We don’t populate the options; we’ll do this using a callback.
If we were only ever going to use one input-dataset, in this case <code>penguins</code>, it might make sense to populate the <code>options</code> when defining the component.
Populating using a callback function makes our code more general, allowing the case where we could upload an abitrary dataset.
Perhaps it wasn’t necessary to follow the more-general approach here, but it allowed me to learn more about how Dash works.</p>
<p>We define our <code>dbc.Select()</code> component completely in the layout.</p>
<p>Note also that we can apply Bootstrap classes to<code>dbc.Button()</code>.
What we might think of as a label is specified as the <code>children</code> of the button element.</p>
</div>
<div id="outputs-2" class="section level4" number="2.2.4.3">
<h4><span class="header-section-number">2.2.4.3</span> Outputs</h4>
<p>It remains to look at the data tables.
There are two tables, identical in form; we will examine only one of them:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="demonstration-app-1.html#cb64-1" aria-hidden="true" tabindex="-1"></a>dash_table.DataTable(</span>
<span id="cb64-2"><a href="demonstration-app-1.html#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="st">&#39;table-inp&#39;</span>,</span>
<span id="cb64-3"><a href="demonstration-app-1.html#cb64-3" aria-hidden="true" tabindex="-1"></a>    page_size<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb64-4"><a href="demonstration-app-1.html#cb64-4" aria-hidden="true" tabindex="-1"></a>    sort_action<span class="op">=</span><span class="st">&#39;native&#39;</span></span>
<span id="cb64-5"><a href="demonstration-app-1.html#cb64-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The properties here are straightforward: we need an <code>id</code>, we want to show ten entries at a time, <code>sort_action='native'</code> indicates that we want sorting to be available (and for Dash to take care of it).</p>
<p>We will populate the data tables using callback functions.</p>
</div>
</div>
<div id="callback-functions" class="section level3" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Callback functions</h3>
<p>In Dash, callback functions are just regular functions with decorators.
Here’s a very generic example:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="demonstration-app-1.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.callback</span>(Output(<span class="st">&#39;output-component&#39;</span>, <span class="st">&#39;output-property&#39;</span>),</span>
<span id="cb65-2"><a href="demonstration-app-1.html#cb65-2" aria-hidden="true" tabindex="-1"></a>              Input(<span class="st">&#39;input-component&#39;</span>, <span class="st">&#39;input-property&#39;</span>))</span>
<span id="cb65-3"><a href="demonstration-app-1.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> some_function_name(x):</span>
<span id="cb65-4"><a href="demonstration-app-1.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> some_function(x)</span>
<span id="cb65-5"><a href="demonstration-app-1.html#cb65-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-6"><a href="demonstration-app-1.html#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span></code></pre></div>
<p>The decorator tells Dash how to build a function that wraps the “actual” function.
We are not concerned with the implementation; we are interested in the interface.</p>
<p>The decorator is this bit of code: <code>@app.callback()</code>.
It takes a series of arguments which map to the function’s parameters and return values:</p>
<ul>
<li><code>Output('output-component', 'output-property')</code> is mapped to the return value.</li>
<li><code>Input('input-component', 'input-property')</code> is mapped to the <code>x</code> parameter.</li>
</ul>
<p>This tells Dash that whenever the <code>input-property</code> of the <code>input-component</code> changes, it should:</p>
<ul>
<li>run the function using the <code>input-property</code> as an argument, then</li>
<li>send the return value to the <code>output-property</code> of the <code>output-component</code></li>
</ul>
<p>We’ll see some more-complex cases in the following examples.</p>
<div id="inputs-2" class="section level4" number="2.2.5.1">
<h4><span class="header-section-number">2.2.5.1</span> Inputs</h4>
<p>We have a couple of input components that need updating: the grouping columns and the aggregation columns.
Each has its own callback, but they are virtually identical, so I’ll describe only one.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="demonstration-app-1.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.callback</span>(Output(<span class="st">&#39;cols-group&#39;</span>, <span class="st">&#39;options&#39;</span>),</span>
<span id="cb66-2"><a href="demonstration-app-1.html#cb66-2" aria-hidden="true" tabindex="-1"></a>              Input(<span class="st">&#39;inp&#39;</span>, <span class="st">&#39;data&#39;</span>))</span>
<span id="cb66-3"><a href="demonstration-app-1.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_cols_group(data_records):</span>
<span id="cb66-4"><a href="demonstration-app-1.html#cb66-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame.from_dict(data_records)</span>
<span id="cb66-5"><a href="demonstration-app-1.html#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cols_choice(df, <span class="st">&#39;object&#39;</span>)</span></code></pre></div>
<p>Whenever the <code>inp</code> <code>data</code> changes:</p>
<ul>
<li>the function is called using the input data (in records form).</li>
<li>the function converts to data-frame format, then</li>
<li>uses our helper function to determine the columns that have string values.</li>
<li>it returns a list of column names, which Dash uses to update the <code>cols-group</code> <code>options</code>.</li>
</ul>
</div>
<div id="calculations" class="section level4" number="2.2.5.2">
<h4><span class="header-section-number">2.2.5.2</span> Calculations</h4>
<p>The callback that performs the aggregation has more going on, but we’ll get to the bottom of it.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="demonstration-app-1.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.callback</span>(Output(<span class="st">&#39;agg&#39;</span>, <span class="st">&#39;data&#39;</span>),</span>
<span id="cb67-2"><a href="demonstration-app-1.html#cb67-2" aria-hidden="true" tabindex="-1"></a>              Input(<span class="st">&#39;button-agg&#39;</span>, <span class="st">&#39;n_clicks&#39;</span>),</span>
<span id="cb67-3"><a href="demonstration-app-1.html#cb67-3" aria-hidden="true" tabindex="-1"></a>              State(<span class="st">&#39;inp&#39;</span>, <span class="st">&#39;data&#39;</span>),</span>
<span id="cb67-4"><a href="demonstration-app-1.html#cb67-4" aria-hidden="true" tabindex="-1"></a>              State(<span class="st">&#39;cols-group&#39;</span>, <span class="st">&#39;value&#39;</span>),</span>
<span id="cb67-5"><a href="demonstration-app-1.html#cb67-5" aria-hidden="true" tabindex="-1"></a>              State(<span class="st">&#39;cols-agg&#39;</span>, <span class="st">&#39;value&#39;</span>),</span>
<span id="cb67-6"><a href="demonstration-app-1.html#cb67-6" aria-hidden="true" tabindex="-1"></a>              State(<span class="st">&#39;func-agg&#39;</span>, <span class="st">&#39;value&#39;</span>),</span>
<span id="cb67-7"><a href="demonstration-app-1.html#cb67-7" aria-hidden="true" tabindex="-1"></a>              prevent_initial_call<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-8"><a href="demonstration-app-1.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aggregate(n_clicks, data_records, cols_group, cols_agg, func_agg):</span>
<span id="cb67-9"><a href="demonstration-app-1.html#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create DataFrame</span></span>
<span id="cb67-10"><a href="demonstration-app-1.html#cb67-10" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame.from_dict(data_records)</span>
<span id="cb67-11"><a href="demonstration-app-1.html#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="demonstration-app-1.html#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># aggregate</span></span>
<span id="cb67-13"><a href="demonstration-app-1.html#cb67-13" aria-hidden="true" tabindex="-1"></a>    df_new <span class="op">=</span> aggregate_df(df, cols_group, cols_agg, func_agg)</span>
<span id="cb67-14"><a href="demonstration-app-1.html#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="demonstration-app-1.html#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># serialize DataFrame</span></span>
<span id="cb67-16"><a href="demonstration-app-1.html#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_new.to_dict(<span class="st">&#39;records&#39;</span>)</span></code></pre></div>
<p>A couple of things to sort through:</p>
<ul>
<li><p>The function has five parameters; the decorator has one <code>Input()</code> and four instances of <code>State()</code>.</p></li>
<li><p>The decorator is provided an additional argument: <code>prevent_initial_call</code>.</p></li>
</ul>
<p>A <code>State()</code> is similar to an <code>Input()</code>; the difference that the function is <strong>not</strong> run in response to a <code>State()</code> change.
In this case, the function is run <em>only</em> in response to the value of the button changing, i.e. being clicked.</p>
<p>The <code>prevent_inital_call</code> argument describes itself well.
By setting it to <code>True</code>, we ensure that the only way the aggregation function will be run is when the button is clicked.</p>
<p>Finally note that we convert our input records into a data frame, then use records-format for the return value.</p>
</div>
<div id="outputs-3" class="section level4" number="2.2.5.3">
<h4><span class="header-section-number">2.2.5.3</span> Outputs</h4>
<p>The final set of callbacks is for our data tables.
Again, although we have two data tables, the callbacks are virtually identical, so I’ll highlight only one.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="demonstration-app-1.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.callback</span>(Output(<span class="st">&#39;table-inp&#39;</span>, <span class="st">&#39;columns&#39;</span>),</span>
<span id="cb68-2"><a href="demonstration-app-1.html#cb68-2" aria-hidden="true" tabindex="-1"></a>              Output(<span class="st">&#39;table-inp&#39;</span>, <span class="st">&#39;data&#39;</span>),</span>
<span id="cb68-3"><a href="demonstration-app-1.html#cb68-3" aria-hidden="true" tabindex="-1"></a>              Input(<span class="st">&#39;inp&#39;</span>, <span class="st">&#39;data&#39;</span>))</span>
<span id="cb68-4"><a href="demonstration-app-1.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_table_inp(data_records):</span>
<span id="cb68-5"><a href="demonstration-app-1.html#cb68-5" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> cols_header(data_records), data_records  </span></code></pre></div>
<p>The thing to note there is that Dash and Python support multiple return-values, mapping each to an <code>Output()</code>.</p>
<p>This situation merits multiple return-values because a Dash data table has a properties for <code>data</code> and <code>columns</code> (headers).
This information comes from the same source, so it made sense to use multiple return-values.</p>
<p>Certainly, you could write two callbacks to do the same things; writing a single callback made more sense to me.
Of course, you should do what makes sense to you.</p>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="principles-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="observable.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub", "_main.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
