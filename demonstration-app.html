<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.2 Demonstration App | Data-Science Reactivity: Three Ways</title>
  <meta name="description" content="1.2 Demonstration App | Data-Science Reactivity: Three Ways" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="1.2 Demonstration App | Data-Science Reactivity: Three Ways" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.2 Demonstration App | Data-Science Reactivity: Three Ways" />
  
  
  

<meta name="author" content="Ian Lyttle" />


<meta name="date" content="2022-03-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="principles.html"/>
<link rel="next" href="dash.html"/>
<script src="libs/header-attrs-2.11.3/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script>
  // wait for the DOM to finish loading, then run function
  window.addEventListener('DOMContentLoaded', (event) => {

    // we want to set some element styles according to the class of the book
    //   - the theme of the book depends on class including:
    //       color-theme-1: means sepia
    //       color-theme-2: means night
    //       neither of these means white

    // see: https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/observe#examples
    // identify an element to observe
    const elementToObserve = document.querySelector(".book");

    // create a new instance of `MutationObserver` named `observer`,
    // passing it a callback function
    const observer = new MutationObserver(function() {

      // img elements with src attribute that end in '.svg'
      const selImageSvg = 'img[src$=".svg"]';

      // span elements used for source-code highlighting
      const selCodeHighlight = 'code.sourceCode > span > span:not(.bu):not(.im)';

      // create a callback function for an element to change its style.filter
      const setFilter = (value) => {
        return (element) => element.style.filter = value;
      }

      if (elementToObserve.classList.contains('color-theme-1')) {
        // console.log('i am sepia');

        // sepia images
        document.querySelectorAll(selImageSvg).forEach(setFilter('sepia(100%'));

        // do nothing to highlighting
        document.querySelectorAll(selCodeHighlight).forEach(setFilter(null));

     } else if (elementToObserve.classList.contains('color-theme-2')) {
        // console.log('i am night');

        // invert images
        document.querySelectorAll(selImageSvg).forEach(setFilter('invert(100%)'));

        // invert highlighting
        document.querySelectorAll(selCodeHighlight).forEach(setFilter('invert(100%)'));

      } else {
        // console.log('i am white');

        // do nothing to images
        document.querySelectorAll(selImageSvg).forEach(setFilter(null));

        // do nothing to highlighting
        document.querySelectorAll(selCodeHighlight).forEach(setFilter(null));
      }

    });

    // call `observe()` on that MutationObserver instance,
    // passing it the element to observe, and the options object
    observer.observe(elementToObserve, {attributeFilter: ['class']});

    // touch class to initiate observe event
    elementToObserve.classList = elementToObserve.classList;

  });
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data-Science Reactivity: Three Ways</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>1</b> Shiny</a>
<ul>
<li class="chapter" data-level="1.1" data-path="principles.html"><a href="principles.html"><i class="fa fa-check"></i><b>1.1</b> Principles</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="principles.html"><a href="principles.html#pure-functions-vs.-side-effects"><i class="fa fa-check"></i><b>1.1.1</b> Pure functions vs. side effects</a></li>
<li class="chapter" data-level="1.1.2" data-path="principles.html"><a href="principles.html#reactives-vs.-observers"><i class="fa fa-check"></i><b>1.1.2</b> Reactives vs. observers</a></li>
<li class="chapter" data-level="1.1.3" data-path="principles.html"><a href="principles.html#using-tidyverse-functions"><i class="fa fa-check"></i><b>1.1.3</b> Using tidyverse functions</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="demonstration-app.html"><a href="demonstration-app.html"><i class="fa fa-check"></i><b>1.2</b> Demonstration App</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="demonstration-app.html"><a href="demonstration-app.html#description"><i class="fa fa-check"></i><b>1.2.1</b> Description</a></li>
<li class="chapter" data-level="1.2.2" data-path="demonstration-app.html"><a href="demonstration-app.html#prelims"><i class="fa fa-check"></i><b>1.2.2</b> Prelims</a></li>
<li class="chapter" data-level="1.2.3" data-path="demonstration-app.html"><a href="demonstration-app.html#helper-functions"><i class="fa fa-check"></i><b>1.2.3</b> Helper functions</a></li>
<li class="chapter" data-level="1.2.4" data-path="demonstration-app.html"><a href="demonstration-app.html#ui"><i class="fa fa-check"></i><b>1.2.4</b> UI</a></li>
<li class="chapter" data-level="1.2.5" data-path="demonstration-app.html"><a href="demonstration-app.html#server-function"><i class="fa fa-check"></i><b>1.2.5</b> Server function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dash.html"><a href="dash.html"><i class="fa fa-check"></i><b>2</b> Dash</a>
<ul>
<li class="chapter" data-level="2.1" data-path="principles-1.html"><a href="principles-1.html"><i class="fa fa-check"></i><b>2.1</b> Principles</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="principles-1.html"><a href="principles-1.html#everything-that-exists-is-a-component"><i class="fa fa-check"></i><b>2.1.1</b> Everything that exists is a component</a></li>
<li class="chapter" data-level="2.1.2" data-path="principles-1.html"><a href="principles-1.html#everything-that-happens-is-a-callback"><i class="fa fa-check"></i><b>2.1.2</b> Everything that happens is a callback</a></li>
<li class="chapter" data-level="2.1.3" data-path="principles-1.html"><a href="principles-1.html#server-cannot-store-state"><i class="fa fa-check"></i><b>2.1.3</b> Server cannot store state</a></li>
<li class="chapter" data-level="2.1.4" data-path="principles-1.html"><a href="principles-1.html#use-json-or-base64"><i class="fa fa-check"></i><b>2.1.4</b> Use JSON or base64</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html"><i class="fa fa-check"></i><b>2.2</b> Demonstration app</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#description-1"><i class="fa fa-check"></i><b>2.2.1</b> Description</a></li>
<li class="chapter" data-level="2.2.2" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#prelims-1"><i class="fa fa-check"></i><b>2.2.2</b> Prelims</a></li>
<li class="chapter" data-level="2.2.3" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#helper-functions-1"><i class="fa fa-check"></i><b>2.2.3</b> Helper functions</a></li>
<li class="chapter" data-level="2.2.4" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#compmonent-layout"><i class="fa fa-check"></i><b>2.2.4</b> Compmonent layout</a></li>
<li class="chapter" data-level="2.2.5" data-path="demonstration-app-1.html"><a href="demonstration-app-1.html#callback-functions"><i class="fa fa-check"></i><b>2.2.5</b> Callback functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="observable.html"><a href="observable.html"><i class="fa fa-check"></i><b>3</b> Observable</a>
<ul>
<li class="chapter" data-level="3.1" data-path="principles-2.html"><a href="principles-2.html"><i class="fa fa-check"></i><b>3.1</b> Principles</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="principles-2.html"><a href="principles-2.html#hosted-service-runs-in-browser"><i class="fa fa-check"></i><b>3.1.1</b> Hosted service runs in browser</a></li>
<li class="chapter" data-level="3.1.2" data-path="principles-2.html"><a href="principles-2.html#reactivity-baked-in"><i class="fa fa-check"></i><b>3.1.2</b> Reactivity baked in</a></li>
<li class="chapter" data-level="3.1.3" data-path="principles-2.html"><a href="principles-2.html#javascript"><i class="fa fa-check"></i><b>3.1.3</b> JavaScript</a></li>
<li class="chapter" data-level="3.1.4" data-path="principles-2.html"><a href="principles-2.html#tidyverse-thinking-helps"><i class="fa fa-check"></i><b>3.1.4</b> Tidyverse thinking helps</a></li>
<li class="chapter" data-level="3.1.5" data-path="principles-2.html"><a href="principles-2.html#viewof-is-a-useful-construct"><i class="fa fa-check"></i><b>3.1.5</b> <code>viewof</code> is a useful construct</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html"><i class="fa fa-check"></i><b>3.2</b> Demonstration app</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html#appendix"><i class="fa fa-check"></i><b>3.2.1</b> Appendix</a></li>
<li class="chapter" data-level="3.2.2" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html#workshop"><i class="fa fa-check"></i><b>3.2.2</b> Workshop</a></li>
<li class="chapter" data-level="3.2.3" data-path="demonstration-app-2.html"><a href="demonstration-app-2.html#showcase"><i class="fa fa-check"></i><b>3.2.3</b> Showcase</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="stray-thoughts.html"><a href="stray-thoughts.html"><i class="fa fa-check"></i><b>A</b> Stray Thoughts</a></li>
<li class="chapter" data-level="B" data-path="field-guide-to-python.html"><a href="field-guide-to-python.html"><i class="fa fa-check"></i><b>B</b> Field Guide to Python</a>
<ul>
<li class="chapter" data-level="B.1" data-path="python-installation.html"><a href="python-installation.html"><i class="fa fa-check"></i><b>B.1</b> Python installation</a></li>
<li class="chapter" data-level="B.2" data-path="project-management.html"><a href="project-management.html"><i class="fa fa-check"></i><b>B.2</b> Project management</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="project-management.html"><a href="project-management.html#git"><i class="fa fa-check"></i><b>B.2.1</b> Git</a></li>
<li class="chapter" data-level="B.2.2" data-path="project-management.html"><a href="project-management.html#virtual-environment"><i class="fa fa-check"></i><b>B.2.2</b> Virtual Environment</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data-Science Reactivity: Three Ways</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="demonstration-app" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Demonstration App</h2>
<p>The goal of this chapter is to highlight some design choices in the <a href="https://github.com/ijlyttle/reactivity-demo-shiny">source code</a> of this <a href="https://ijlyttle.shinyapps.io/aggregate-local">demonstration Shiny app</a>.</p>
<div id="description" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Description</h3>
<p>To start with, spend a few minutes playing with the <a href="https://github.com/ijlyttle/reactivity-demo-shiny">app</a>, while referring back to these diagrams:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="images/shiny-aggregate-local.svg" alt="Reactivity diagram"  />
<p class="caption">
Figure 1.1: Reactivity diagram
</p>
</div>
<p>Each <code>input</code> and <code>output</code> you see in the diagram is a part of the UI of the app.
The reactive expressions, in this case: <code>inp</code> and <code>agg</code>, are found only in the app’s server-function.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="images/shiny-legend.svg" alt="Legend"  />
<p class="caption">
Figure 1.2: Legend
</p>
</div>
<p>The solid lines indicate immediate downstream-evaluation if the upstream value changes; this is what we think of when we hear “reactivity”.
The dashed lines indicate that downstream-evaluation does not immediate follow an upstream change.
For example, the reactive-expression <code>agg</code> is updated only when the <code>button</code> is pushed.</p>
<p>Spend some time to study the app, to make sure that these diagrams agree with your understanding of how the app operates.
In the following sections, we’ll discuss how to implement in your Shiny code.</p>
</div>
<div id="prelims" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Prelims</h3>
<p>In the rest of this chapter, we’ll highlight the code used to make app, and the design choices behind the code.
In the <a href="https://github.com/ijlyttle/reactivity-demo-shiny">repository</a>, there are a couple of files to pay attention to:</p>
<pre><code>app-aggregate-local.R
R/
  aggregate-local.R</code></pre>
<p>Here’s the start of the app file, <code>app-aggregate-local.R</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="demonstration-app.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;shiny&quot;</span>)</span>
<span id="cb5-2"><a href="demonstration-app.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="demonstration-app.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------- </span></span>
<span id="cb5-4"><a href="demonstration-app.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># global functions</span></span>
<span id="cb5-5"><a href="demonstration-app.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------- </span></span>
<span id="cb5-6"><a href="demonstration-app.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-7"><a href="demonstration-app.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># created outside of reactive environment, making it easier:</span></span>
<span id="cb5-8"><a href="demonstration-app.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   - to test</span></span>
<span id="cb5-9"><a href="demonstration-app.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   - to migrate to a package</span></span>
<span id="cb5-10"><a href="demonstration-app.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;./R/aggregate-local.R&quot;</span>)</span></code></pre></div>
<p>As you can see, it sources <code>R/aggregate-local.R</code>, which contains our helper functions.</p>
</div>
<div id="helper-functions" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Helper functions</h3>
<p>Before writing a Shiny app, I like to write out a set of non-reactive functions that will do the “heavy lifting”.
To the extent possible, these are pure functions; this will make it easier to test.
I keep these functions in an <code>R</code> folder alongside my app; here’s a <a href="https://github.com/ijlyttle/reactivity-demo-shiny/blob/main/R/aggregate-local.R">link</a> to the actual code.</p>
<p>Just like in the app, we’ll use the <a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a> dataset:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="demonstration-app.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is not part of the helper functions - it&#39;s for exposition here</span></span>
<span id="cb6-2"><a href="demonstration-app.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;palmerpenguins&quot;</span>)</span>
<span id="cb6-3"><a href="demonstration-app.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tibble&quot;</span>)</span>
<span id="cb6-4"><a href="demonstration-app.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="demonstration-app.html#cb6-5" aria-hidden="true" tabindex="-1"></a>penguins</span></code></pre></div>
<pre><code>## # A tibble: 344 × 8
##    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##    &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
##  1 Adelie  Torgersen           39.1          18.7               181        3750
##  2 Adelie  Torgersen           39.5          17.4               186        3800
##  3 Adelie  Torgersen           40.3          18                 195        3250
##  4 Adelie  Torgersen           NA            NA                  NA          NA
##  5 Adelie  Torgersen           36.7          19.3               193        3450
##  6 Adelie  Torgersen           39.3          20.6               190        3650
##  7 Adelie  Torgersen           38.9          17.8               181        3625
##  8 Adelie  Torgersen           39.2          19.6               195        4675
##  9 Adelie  Torgersen           34.1          18.1               193        3475
## 10 Adelie  Torgersen           42            20.2               190        4250
## # … with 334 more rows, and 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
<p>In fact, the first bit of code is not even a function.
It is an enumeration of the choices for the aggregation function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="demonstration-app.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># choices for aggregation functions</span></span>
<span id="cb8-2"><a href="demonstration-app.html#cb8-2" aria-hidden="true" tabindex="-1"></a>agg_function_choices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;max&quot;</span>)</span></code></pre></div>
<p>We’ll use it in a few places, so I want to define it only once.</p>
<p>Next, a couple of functions that, given a data frame, return the names of:</p>
<ul>
<li>numerical variables</li>
<li>categorical variables</li>
</ul>
<p>You might quibble with how I’ve defined these here, but it works for me, for this example.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="demonstration-app.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># given a data frame, return the names of numeric columns</span></span>
<span id="cb9-2"><a href="demonstration-app.html#cb9-2" aria-hidden="true" tabindex="-1"></a>cols_number <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb9-3"><a href="demonstration-app.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  df_select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df, <span class="fu">where</span>(<span class="sc">~</span><span class="fu">is.numeric</span>(.x) <span class="sc">|</span> <span class="fu">is.integer</span>(.x)) ) </span>
<span id="cb9-4"><a href="demonstration-app.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df_select)</span>
<span id="cb9-5"><a href="demonstration-app.html#cb9-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="demonstration-app.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># given a data frame, return the names of string and factor columns</span></span>
<span id="cb10-2"><a href="demonstration-app.html#cb10-2" aria-hidden="true" tabindex="-1"></a>cols_category <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb10-3"><a href="demonstration-app.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  df_select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df, <span class="fu">where</span>(<span class="sc">~</span><span class="fu">is.character</span>(.x) <span class="sc">|</span> <span class="fu">is.factor</span>(.x)) ) </span>
<span id="cb10-4"><a href="demonstration-app.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df_select)</span>
<span id="cb10-5"><a href="demonstration-app.html#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>You may have noticed that I refer to functions using the package name, e.g. <code>dplyr::select()</code>.
This is a habit I learned following Hadley Wickham; basically:</p>
<ul>
<li><p>I like to be as explicit as possible when writing functions.
It provides fewer opportunities for strange things to happen; I provide enough opportunities as it is.</p></li>
<li><p>The function is more ready to be included in a package.</p></li>
</ul>
<p>As advertised, testing (or at least spot-verification) is straightforward:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="demonstration-app.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cols_number</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;bill_length_mm&quot;    &quot;bill_depth_mm&quot;     &quot;flipper_length_mm&quot;
## [4] &quot;body_mass_g&quot;       &quot;year&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="demonstration-app.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cols_category</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;species&quot; &quot;island&quot;  &quot;sex&quot;</code></pre>
<p>Let’s look at the aggregation function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="demonstration-app.html#cb15-1" aria-hidden="true" tabindex="-1"></a>group_aggregate <span class="ot">&lt;-</span> <span class="cf">function</span>(df, str_group, str_agg, str_fn_agg, </span>
<span id="cb15-2"><a href="demonstration-app.html#cb15-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">str_fn_choices =</span> agg_function_choices) {</span>
<span id="cb15-3"><a href="demonstration-app.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="demonstration-app.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># validate the aggregation function</span></span>
<span id="cb15-5"><a href="demonstration-app.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb15-6"><a href="demonstration-app.html#cb15-6" aria-hidden="true" tabindex="-1"></a>    str_fn_agg <span class="sc">%in%</span> str_fn_choices</span>
<span id="cb15-7"><a href="demonstration-app.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-8"><a href="demonstration-app.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="demonstration-app.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the aggregation function</span></span>
<span id="cb15-10"><a href="demonstration-app.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  func <span class="ot">&lt;-</span> <span class="fu">get</span>(str_fn_agg)</span>
<span id="cb15-11"><a href="demonstration-app.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="demonstration-app.html#cb15-12" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span></span>
<span id="cb15-13"><a href="demonstration-app.html#cb15-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(str_group))) <span class="sc">|&gt;</span></span>
<span id="cb15-14"><a href="demonstration-app.html#cb15-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb15-15"><a href="demonstration-app.html#cb15-15" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(str_agg), func, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-16"><a href="demonstration-app.html#cb15-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-17"><a href="demonstration-app.html#cb15-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>There’s a few things I want to point out about this function:</p>
<ul>
<li><p>Aside from the data frame, all the arguments are strings.
It is designed for use with Shiny, not for interactive use.</p></li>
<li><p>We are using <code>agg_function_choices</code> to make sure that we won’t execute arbitrary code.
We turn the string into binding to a function using <code>get()</code>.</p></li>
<li><p>We use dplyr’s <code>across()</code> function, which lets us use <code>select()</code> semantics in “data-masking” functions, e.g. <code>group_by()</code>, <code>summarise()</code>.</p></li>
<li><p>To select data-frame variables using strings, we use <code>all_of()</code>.</p></li>
</ul>
<p>For example if we were grouping by <code>"island"</code>, then aggregating over <code>"bill_length_mm"</code> and <code>"bill_depth_mm"</code> using <code>"mean"</code>,
our interactive code might look like:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="demonstration-app.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="demonstration-app.html#cb20-1" aria-hidden="true" tabindex="-1"></a>aggregate_interactive <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="demonstration-app.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  penguins <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="demonstration-app.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(island) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="demonstration-app.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-5"><a href="demonstration-app.html#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_length_mm =</span> <span class="fu">mean</span>(bill_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-6"><a href="demonstration-app.html#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_depth_mm =</span> <span class="fu">mean</span>(bill_depth_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-7"><a href="demonstration-app.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-8"><a href="demonstration-app.html#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="demonstration-app.html#cb20-9" aria-hidden="true" tabindex="-1"></a>aggregate_interactive</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   island    bill_length_mm bill_depth_mm
##   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
## 1 Biscoe              45.3          15.9
## 2 Dream               44.2          18.3
## 3 Torgersen           39.0          18.4</code></pre>
<p>We can use this result to help verify that our “string” version is working:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="demonstration-app.html#cb22-1" aria-hidden="true" tabindex="-1"></a>aggregate_string <span class="ot">&lt;-</span> <span class="fu">group_aggregate</span>(</span>
<span id="cb22-2"><a href="demonstration-app.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  penguins, </span>
<span id="cb22-3"><a href="demonstration-app.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">str_group =</span> <span class="st">&quot;island&quot;</span>, </span>
<span id="cb22-4"><a href="demonstration-app.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">str_agg =</span> <span class="fu">c</span>(<span class="st">&quot;bill_length_mm&quot;</span>, <span class="st">&quot;bill_depth_mm&quot;</span>),</span>
<span id="cb22-5"><a href="demonstration-app.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">str_fn_agg =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb22-6"><a href="demonstration-app.html#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-7"><a href="demonstration-app.html#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="demonstration-app.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(aggregate_interactive, aggregate_string)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="ui" class="section level3" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> UI</h3>
<p>The UI object is relatively straightforward; we use a <code>fluidPage()</code> with a narrower column for inputs and a wider column for outputs.</p>
<p>To give a clearer view of the high-level structure of the page, I replaced the code for the inputs and outputs with <code>...</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="demonstration-app.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;shiny&quot;</span>)</span>
<span id="cb24-2"><a href="demonstration-app.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="demonstration-app.html#cb24-3" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb24-4"><a href="demonstration-app.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Aggregator&quot;</span>),</span>
<span id="cb24-5"><a href="demonstration-app.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb24-6"><a href="demonstration-app.html#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb24-7"><a href="demonstration-app.html#cb24-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>, </span>
<span id="cb24-8"><a href="demonstration-app.html#cb24-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">wellPanel</span>(</span>
<span id="cb24-9"><a href="demonstration-app.html#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">h3</span>(<span class="st">&quot;Aggregation&quot;</span>),</span>
<span id="cb24-10"><a href="demonstration-app.html#cb24-10" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb24-11"><a href="demonstration-app.html#cb24-11" aria-hidden="true" tabindex="-1"></a>      )s</span>
<span id="cb24-12"><a href="demonstration-app.html#cb24-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-13"><a href="demonstration-app.html#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb24-14"><a href="demonstration-app.html#cb24-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb24-15"><a href="demonstration-app.html#cb24-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Input data&quot;</span>),</span>
<span id="cb24-16"><a href="demonstration-app.html#cb24-16" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb24-17"><a href="demonstration-app.html#cb24-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">hr</span>(),</span>
<span id="cb24-18"><a href="demonstration-app.html#cb24-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3</span>(<span class="st">&quot;Aggregated data&quot;</span>),</span>
<span id="cb24-19"><a href="demonstration-app.html#cb24-19" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb24-20"><a href="demonstration-app.html#cb24-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-21"><a href="demonstration-app.html#cb24-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-22"><a href="demonstration-app.html#cb24-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="inputs" class="section level4" number="1.2.4.1">
<h4><span class="header-section-number">1.2.4.1</span> Inputs</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="demonstration-app.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wellPanel</span>(</span>
<span id="cb25-2"><a href="demonstration-app.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h3</span>(<span class="st">&quot;Aggregation&quot;</span>),</span>
<span id="cb25-3"><a href="demonstration-app.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb25-4"><a href="demonstration-app.html#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">inputId =</span> <span class="st">&quot;cols_group&quot;</span>,</span>
<span id="cb25-5"><a href="demonstration-app.html#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Grouping columns&quot;</span>,</span>
<span id="cb25-6"><a href="demonstration-app.html#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> <span class="fu">c</span>(),</span>
<span id="cb25-7"><a href="demonstration-app.html#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb25-8"><a href="demonstration-app.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  ),        </span>
<span id="cb25-9"><a href="demonstration-app.html#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb25-10"><a href="demonstration-app.html#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">inputId =</span> <span class="st">&quot;cols_agg&quot;</span>,</span>
<span id="cb25-11"><a href="demonstration-app.html#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Aggregation columns&quot;</span>,</span>
<span id="cb25-12"><a href="demonstration-app.html#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> <span class="fu">c</span>(),</span>
<span id="cb25-13"><a href="demonstration-app.html#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb25-14"><a href="demonstration-app.html#cb25-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb25-15"><a href="demonstration-app.html#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb25-16"><a href="demonstration-app.html#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">inputId =</span> <span class="st">&quot;func_agg&quot;</span>,</span>
<span id="cb25-17"><a href="demonstration-app.html#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Aggregation function&quot;</span>,</span>
<span id="cb25-18"><a href="demonstration-app.html#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> agg_function_choices,</span>
<span id="cb25-19"><a href="demonstration-app.html#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple =</span> <span class="cn">FALSE</span></span>
<span id="cb25-20"><a href="demonstration-app.html#cb25-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb25-21"><a href="demonstration-app.html#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">actionButton</span>(</span>
<span id="cb25-22"><a href="demonstration-app.html#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">inputId =</span> <span class="st">&quot;button&quot;</span>,</span>
<span id="cb25-23"><a href="demonstration-app.html#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Submit&quot;</span></span>
<span id="cb25-24"><a href="demonstration-app.html#cb25-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-25"><a href="demonstration-app.html#cb25-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>One of the inputs I would like to point out is for <code>input$cols_group</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="demonstration-app.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">selectizeInput</span>(</span>
<span id="cb26-2"><a href="demonstration-app.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputId =</span> <span class="st">&quot;cols_group&quot;</span>,</span>
<span id="cb26-3"><a href="demonstration-app.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">&quot;Grouping columns&quot;</span>,</span>
<span id="cb26-4"><a href="demonstration-app.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">choices =</span> <span class="fu">c</span>(),</span>
<span id="cb26-5"><a href="demonstration-app.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb26-6"><a href="demonstration-app.html#cb26-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Note that the initial <code>choices</code> is supplied as an empty vector.
Note also that the reactivity diagram for <code>cols_group</code> indicates that, we use an observer function to update this input.
We’ll do this in the server function, where we update the <code>choices</code>.</p>
</div>
<div id="outputs" class="section level4" number="1.2.4.2">
<h4><span class="header-section-number">1.2.4.2</span> Outputs</h4>
<p>The outputs are fairly strightforward; we are using <code>DT::DTOutput()</code> as placeholders for <a href="https://rstudio.github.io/DT/">DT DataTables</a>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="demonstration-app.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">column</span>(</span>
<span id="cb27-2"><a href="demonstration-app.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb27-3"><a href="demonstration-app.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h3</span>(<span class="st">&quot;Input data&quot;</span>),</span>
<span id="cb27-4"><a href="demonstration-app.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">DTOutput</span>(</span>
<span id="cb27-5"><a href="demonstration-app.html#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">outputId =</span> <span class="st">&quot;table_inp&quot;</span></span>
<span id="cb27-6"><a href="demonstration-app.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-7"><a href="demonstration-app.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hr</span>(),</span>
<span id="cb27-8"><a href="demonstration-app.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h3</span>(<span class="st">&quot;Aggregated data&quot;</span>),</span>
<span id="cb27-9"><a href="demonstration-app.html#cb27-9" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">DTOutput</span>(</span>
<span id="cb27-10"><a href="demonstration-app.html#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">outputId =</span> <span class="st">&quot;table_agg&quot;</span></span>
<span id="cb27-11"><a href="demonstration-app.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  )      </span>
<span id="cb27-12"><a href="demonstration-app.html#cb27-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="server-function" class="section level3" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Server function</h3>
<p>This may be a habit particular to me, but I like to organize a server-function into groups:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="demonstration-app.html#cb28-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb28-2"><a href="demonstration-app.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># input observers</span></span>
<span id="cb28-3"><a href="demonstration-app.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reactive expressions and values</span></span>
<span id="cb28-4"><a href="demonstration-app.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outputs</span></span>
<span id="cb28-5"><a href="demonstration-app.html#cb28-5" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<div id="input-observers" class="section level4" number="1.2.5.1">
<h4><span class="header-section-number">1.2.5.1</span> Input observers</h4>
<p>There are two inputs: <code>cols_group</code> and <code>cols_agg</code>, whose <code>choices</code> change when the input data-frame changes.</p>
<p>To make such a change, we use a Shiny <code>observe()</code>, which runs when any of its reactive dependencies change.
An <code>observe()</code> does not return a value; instead, it causes a side-effect.
In this case, it changes an input element in the DOM.</p>
<p>The observers are substantially similar, so I’ll show only <code>cols_group</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="demonstration-app.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">observe</span>({</span>
<span id="cb29-2"><a href="demonstration-app.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this runs whenever the parsed input data changes</span></span>
<span id="cb29-3"><a href="demonstration-app.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateSelectizeInput</span>(</span>
<span id="cb29-4"><a href="demonstration-app.html#cb29-4" aria-hidden="true" tabindex="-1"></a>    session,</span>
<span id="cb29-5"><a href="demonstration-app.html#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">inputId =</span> <span class="st">&quot;cols_group&quot;</span>,</span>
<span id="cb29-6"><a href="demonstration-app.html#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> <span class="fu">cols_category</span>(<span class="fu">inp</span>())</span>
<span id="cb29-7"><a href="demonstration-app.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-8"><a href="demonstration-app.html#cb29-8" aria-hidden="true" tabindex="-1"></a>}) </span></code></pre></div>
<p>Note that one of our helper functions, <code>cols_category()</code>, makes an appearance.
The <code>choices</code> for the <code>cols_group</code> input are updated according to the names of the categorical variables in the data frame returned by <code>inp()</code>.</p>
</div>
<div id="reactive-expressions" class="section level4" number="1.2.5.2">
<h4><span class="header-section-number">1.2.5.2</span> Reactive expressions</h4>
<p>This app uses two reactive expressions:</p>
<ul>
<li><code>inp()</code>, which returns the input data-frame.</li>
<li><code>agg()</code>, which returns the aggregated data-frame.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="demonstration-app.html#cb30-1" aria-hidden="true" tabindex="-1"></a>inp <span class="ot">&lt;-</span> </span>
<span id="cb30-2"><a href="demonstration-app.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reactive</span>({ </span>
<span id="cb30-3"><a href="demonstration-app.html#cb30-3" aria-hidden="true" tabindex="-1"></a>    palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb30-4"><a href="demonstration-app.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  }) </span></code></pre></div>
<p>For this app, we probably did not need to wrap <code>palmerpenguins::penguins</code> in a <code>reactive()</code>.
I did this with future expansion in mind, where <code>inp()</code> could also return a data frame according to a choice, or even a data frame parsed from an uploaded CSV file.</p>
<p>The reactive expression for <code>agg()</code>, the aggregated data-frame, is more interesting:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="demonstration-app.html#cb31-1" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> </span>
<span id="cb31-2"><a href="demonstration-app.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reactive</span>({</span>
<span id="cb31-3"><a href="demonstration-app.html#cb31-3" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb31-4"><a href="demonstration-app.html#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(input<span class="sc">$</span>func_agg <span class="sc">%in%</span> agg_function_choices)</span>
<span id="cb31-5"><a href="demonstration-app.html#cb31-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-6"><a href="demonstration-app.html#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_aggregate</span>(</span>
<span id="cb31-7"><a href="demonstration-app.html#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">inp</span>(), </span>
<span id="cb31-8"><a href="demonstration-app.html#cb31-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">str_group =</span> input<span class="sc">$</span>cols_group, </span>
<span id="cb31-9"><a href="demonstration-app.html#cb31-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">str_agg =</span> input<span class="sc">$</span>cols_agg, </span>
<span id="cb31-10"><a href="demonstration-app.html#cb31-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">str_fn_agg =</span> input<span class="sc">$</span>func_agg</span>
<span id="cb31-11"><a href="demonstration-app.html#cb31-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-12"><a href="demonstration-app.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb31-13"><a href="demonstration-app.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bindEvent</span>(input<span class="sc">$</span>button, <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span>, <span class="at">ignoreInit =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The first thing we do in the reactive is make sure that the value of <code>input$func_agg</code> is among the choices we specified.
I’m sure you noticed that this is a redundant check.
Although this is one place I strive for redundancy, I am careful to validate using the same values: <code>agg_function_choices</code>.
You can read more about input validation in the <a href="https://mastering-shiny.org/scaling-security.html">security chapter</a> of Mastering Shiny.</p>
<p>Then, we use our <code>group_aggregate()</code> helper function.
For me, having tested it outside of Shiny helped me focus on getting the rest of the code working.</p>
<p>The <code>reactive()</code> expression returns the data; the expression itself is piped to <code>bindEvent()</code>, which will run the <code>reactive()</code>, and return its value, only when the value of <code>input$button</code> changes.
This is a relatively new pattern in Shiny; it appeared in v1.6.0.</p>
<p><code>bindEvent()</code> has a couple of options:</p>
<ul>
<li><code>ignoreNULL = FALSE</code>: the <code>reactive()</code> is not evaluated if <code>input$button</code> is zero.</li>
<li><code>ignoreInit = FALSE</code>: the <code>reactive()</code> is not evaluated when the app is first initialized.</li>
</ul>
<p>In this case, the <code>reactive()</code> is evaluated only in response to a button-click.
This can be a useful pattern if the <code>reactive()</code> contains a long-running computation, or a call to an external resource.
You may also be interested in Shiny’s <code>bindCache()</code> function.</p>
</div>
<div id="outputs-1" class="section level4" number="1.2.5.3">
<h4><span class="header-section-number">1.2.5.3</span> Outputs</h4>
<p>There two outputs: one for the <code>inp()</code> data, the other for the <code>agg()</code> data; each is a table output.</p>
<p>These outputs are similar to one another; we’ll focus on <code>output$table_inp</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="demonstration-app.html#cb32-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>table_inp <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDT</span>(<span class="fu">inp</span>())</span></code></pre></div>
<p>The table output is a straightforward use of <code>DT::renderDT()</code>.</p>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="principles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dash.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub", "_main.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
